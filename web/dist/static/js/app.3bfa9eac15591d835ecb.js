webpackJsonp([1],{"/pAE":function(e,t){},0:function(e,t){},"1/oy":function(e,t){},HPwT:function(e,t){},Id91:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("7+uW"),a=r("8+8L"),s=r("e6fC"),o=r("bm7V"),i=r.n(o),u={name:"App",created:function(){var e=this;!function t(){e.$http.get("updated_time?_="+ +new Date).then(function(r){r.data.is_alive?(r.data.updated_time!==e.$store.state.race.updatedTime&&(e.$http.get("race").then(function(t){e.$store.commit("setRace",t.data)}),e.$store.commit("setUpdatedTime",r.data.updated_time)),setTimeout(t,1e3)):e.$http.get("shutdown?_="+ +new Date).then()})}()}},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var l=r("VU/8")(u,c,!1,function(e){r("/pAE")},null,null).exports,d=r("/ocq"),p=r("Gu7T"),f=r.n(p),v=r("BO1k"),m=r.n(v),g={name:"race-info",data:function(){return{selectedOrg:"",selectedPerson:"",isRelay:!1}},methods:{getResults:function(e){var t=this;this.isRelay=this.$store.state.race.race&&3===this.$store.state.race.race.data.race_type;var r=[];if(this.$store.state.race.race&&this.$store.state.race.race.results){var n=!0,a=!1,s=void 0;try{for(var o,i=m()(this.$store.state.race.race.results);!(n=(o=i.next()).done);n=!0){var u=o.value;u.person&&u.person.group&&u.person.group.id===e.id&&function(){var e={id:u.person.id+"-"+u.id,created_at:u.created_at,bib:u.person.bib,surname:u.person.surname,name:u.person.name,year:u.person.birth_date?new Date(u.person.birth_date).getFullYear():"",org:u.person.organization&&u.person.organization.name||"",startTime:u.start_time||u.person.start_time||0,place:u.place||"",data:u,result:u.result,_showDetails:!1};t.selectedOrg&&t.selectedOrg===e.org&&(e._rowVariant="success"),t.isNew(1e3*e.created_at)&&(e._rowVariant="danger"),t.selectedPerson&&t.selectedPerson===e.id&&(e._rowVariant="warning",setTimeout(function(){e._rowVariant=""},2e3)),r.push(e)}()}}catch(e){a=!0,s=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw s}}}if(r.sort(function(e,r){return""===e.place?1:""===r.place?-1:t.isRelay&&e.place===r.place?~~(e.bib/1e3)-~~(r.bib/1e3):e.place-r.place}),this.isRelay){var c=0,l=[].concat(f()(r));r=[];var d=!0,p=!1,v=void 0;try{for(var g,h=m()(l);!(d=(g=h.next()).done);d=!0){var _=g.value;_.bib%1e3!==c&&(r.push({_rowVariant:"secondary",data:{}}),c=_.bib%1e3),r.push(_)}}catch(e){p=!0,v=e}finally{try{!d&&h.return&&h.return()}finally{if(p)throw v}}}return r},getAllResults:function(){var e=[];if(this.$store.state.race.race&&this.$store.state.race.race.results){var t=!0,r=!1,n=void 0;try{for(var a,s=m()(this.$store.state.race.race.results);!(t=(a=s.next()).done);t=!0){var o=a.value;if(o.person){var i={id:o.person.id+"-"+o.id,created_at:o.created_at,bib:o.person.bib,surname:o.person.surname,name:o.person.name,group:o.person.group&&o.person.group.name||"",groupId:o.person.group&&o.person.group.id||"",place:o.place||"",data:o};this.isNew(1e3*i.created_at)&&(i._rowVariant="danger"),e.push(i)}}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}}return e.sort(function(e,t){return t.created_at-e.created_at}),e},selectOrg:function(e){this.selectedOrg===e?this.selectedOrg="":this.selectedOrg=e},scrollToGroup:function(e){this.$scrollTo("#group"+e,500,{container:"#group-results"})},scrollToPerson:function(e){this.selectedPerson=e,this.$scrollTo("#person"+e,500,{container:"#group-results",offset:-window.innerHeight/2})},isNew:function(e){return+new Date-e<3e4},getCountPersons:function(){var e=this.$store.state.race.race;return e&&e.persons&&e.persons.length||0},getCountOutPersons:function(){var e=this.$store.state.race.race;return e&&e.persons&&e.results?e.persons.length-e.results.filter(function(e){return e.person}).length:0}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"race-info"},[r("b-container",{attrs:{fluid:""}},[r("b-row",[r("b-col",{attrs:{cols:"12"}},[r("b-button-group",e._l(e.$store.getters.getGroups,function(t){return r("b-button",{key:"b"+t.id,on:{click:function(r){e.scrollToGroup(t.id)}}},[e._v(e._s(t.name))])})),e._v(" "),e.$store.state.race.race?r("b-badge",{attrs:{variant:"primary"}},[e._v(e._s(e.getCountPersons()))]):e._e(),e._v(" "),e.$store.state.race.race&&e.getCountOutPersons()?r("b-badge",{attrs:{variant:"danger"}},[e._v(e._s(e.getCountOutPersons()))]):e._e()],1),e._v(" "),r("b-col",{attrs:{cols:"3"}},[r("b-card",{directives:[{name:"resize",rawName:"v-resize",value:70,expression:"70"}],staticClass:"indentation-top"},[r("b-table",{attrs:{small:"",hover:"",fields:["bib","surname","name","group","place"],items:e.getAllResults()},scopedSlots:e._u([{key:"surname",fn:function(t){return[r("span",{staticClass:"clickable",on:{click:function(r){e.scrollToPerson(t.item.id)}}},[e._v(e._s(t.item.surname))])]}},{key:"name",fn:function(t){return[r("span",{staticClass:"clickable",on:{click:function(r){e.scrollToPerson(t.item.id)}}},[e._v(e._s(t.item.name))])]}},{key:"group",fn:function(t){return[t.item.group?r("span",{staticClass:"clickable",on:{click:function(r){e.scrollToGroup(t.item.groupId)}}},[e._v(e._s(t.item.group))]):e._e()]}}])})],1)],1),e._v(" "),r("b-col",{attrs:{cols:"9"}},[r("b-row",[r("b-col",{attrs:{cols:"12"}},[r("div",{directives:[{name:"resize",rawName:"v-resize",value:70,expression:"70"}],staticClass:"indentation-top",attrs:{id:"group-results"}},e._l(e.$store.getters.getGroups,function(t){return r("b-card",{key:t.id,staticClass:"indentation-bottom",attrs:{id:"group"+t.id,title:t.name,"sub-title":t.long_name}},[r("b-table",{attrs:{responsive:"",small:"",hover:"",fields:["n","bib","surname","name","year","org","place","result"],items:e.getResults(t)},scopedSlots:e._u([{key:"n",fn:function(t){return[void 0!==t.item.bib?r("b-button",{attrs:{size:"sm",variant:"outline-secondary"},on:{click:t.toggleDetails}},[e._v(e._s(t.detailsShowing?"-":"+"))]):e._e()]}},{key:"surname",fn:function(t){return[r("i",{attrs:{id:"person"+t.item.id}}),e._v(e._s(t.item.surname)+"\n                  ")]}},{key:"org",fn:function(t){return[r("span",{staticClass:"clickable",on:{click:function(r){e.selectOrg(t.item.org)}}},[e._v(e._s(t.item.org))])]}},{key:"row-details",fn:function(t){return[r("b-card",[(t.item.data.type="ResultSportident")?r("b-table",{attrs:{fields:["code","time"],items:t.item.data.splits},scopedSlots:e._u([{key:"time",fn:function(t){return[e._v("\n                          "+e._s(e._f("hhmmss")(t.item.time))+"\n                        ")]}}])}):e._e()],1)]}}])})],1)}))])],1)],1)],1)],1)],1)},staticRenderFns:[]};var _=r("VU/8")(g,h,!1,function(e){r("HPwT")},"data-v-25fae7e3",null).exports;n.a.use(d.a);var b=new d.a({routes:[{path:"/",name:"RaceInfo",component:_}]}),y=r("NYxO"),w={state:{isLoading:!0},getters:{isLoading:function(e){return e.isLoading}},mutations:{setLoading:function(e,t){e.isLoading=t}},actions:{}};function $(e,t){if(t){var r=!0,n=!1,a=void 0;try{for(var s,o=m()(e);!(r=(s=o.next()).done);r=!0){var i=s.value;if(i.id===t)return i}}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}}return null}var k={state:{race:{},updatedTime:0},getters:{race:function(e){return e.race},updated_time:function(e){return e.updatedTime},getGroups:function(e){return e.race&&e.race.groups||[]}},actions:{},mutations:{setRace:function(e,t){var r=!0,n=!1,a=void 0;try{for(var s,o=m()(t.persons);!(r=(s=o.next()).done);r=!0){var i=s.value;i.organization=$(t.organizations,i.organization_id),i.group=$(t.groups,i.group_id)}}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}var u=!0,c=!1,l=void 0;try{for(var d,p=m()(t.results);!(u=(d=p.next()).done);u=!0){var f=d.value;f.person=$(t.persons,f.person_id)}}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}var v=!0,g=!1,h=void 0;try{for(var _,b=m()(t.groups);!(v=(_=b.next()).done);v=!0){var y=_.value;y.course=$(t.courses,y.course_id)}}catch(e){g=!0,h=e}finally{try{!v&&b.return&&b.return()}finally{if(g)throw h}}for(var w=["groups","courses"],k=0;k<w.length;k++){t[w[k]].sort(function(e,t){return e.name.toUpperCase()<t.name.toUpperCase()?-1:e.name.toUpperCase()>t.name.toUpperCase()?1:0})}e.race=t},setUpdatedTime:function(e,t){e.updatedTime=t}}};n.a.use(y.a);var T,C=new y.a.Store({modules:{app:w,race:k},strict:!1}),P=(T=void 0,{inserted:function(e,t){var r=0;t.value&&(r=t.value),e.style.overflow="auto",(T=function(){e.style.height=window.innerHeight-r+"px"})(),window.addEventListener("resize",T)},unbind:function(){window.removeEventListener("resize",T)}});n.a.use(a.a),n.a.use(s.a),n.a.use(i.a),n.a.directive("resize",P),n.a.filter("hhmmss",function(e){if(!e)return"";e/=1e3;var t=Math.floor(e/3600);e%=3600;var r=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(r=r<10?"0"+r:r)+":"+(n=n<10?"0"+n:n)}),n.a.http.options.root="api/v1",n.a.config.productionTip=!1,b.beforeEach(function(e,t,r){C.commit("setLoading",!0),r()}),b.afterEach(function(e,t){C.commit("setLoading",!1)}),window.shutDown=function(){console.log("Server shutting down..."),n.a.http.post("shutdown").then()},new n.a({el:"#app",router:b,store:C,components:{App:l},template:"<App/>"})},zj2Q:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.3bfa9eac15591d835ecb.js.map